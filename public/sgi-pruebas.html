<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario | SGI - Gestión Completa</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        /* --- ESTILOS AÑADIDOS PARA LA SECCIÓN "ACERCA DE" --- */
        #acerca-content {
            padding: 30px;
            text-align: center;
        }

        .acerca-title { font-size: 2.2em; }
        .acerca-subtitle { font-size: 1.6em; color: #333; border-bottom: none; padding-bottom: 10px; margin-top: 30px; text-align: left; }
        .acerca-version, .acerca-slogan { font-size: 1.1em; color: #333; }
        .acerca-slogan { font-style: italic; color: var(--color-secondary); font-weight: 500;}

        /* Contenedor del Logo */
        #acerca-logo-container {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px dashed #ccc;
        }
        #acerca-logo-img {
            width: 130px; /* Nuevo tamaño */
            height: 130px; /* Nuevo tamaño */
            border-radius: 50%;
            box-shadow: var(--shadow-light);
            margin-bottom: 10px;
        }

        /* Contenedor de Desarrolladores */
        #acerca-devs-container {
            /* MANTENEMOS FLEX para centrar el grupo, PERO ahora cada tarjeta se comportará como una fila */
            display: flex;
            flex-direction: column; /* <-- CLAVE: Asegura que los elementos se apilen verticalmente */
            align-items: center; /* CLAVE: Centra las tarjetas horizontalmente */
            gap: 20px; /* Espacio vertical entre las tarjetas */
            margin: 30px 0;
            padding: 10px;
        }

        .dev-card {
            background-color: #ffffff;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-deep);
            width: 90%; /* Ajuste para que ocupe casi todo el ancho disponible del contenedor */
            max-width: 400px; /* CLAVE: Define un ancho máximo para la tarjeta, pero se centrará */
            text-align: center;
            transition: transform 0.3s;
            /* Usamos flex para ordenar el contenido dentro de la tarjeta verticalmente */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dev-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .dev-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 4px solid var(--color-primary);
        }

        .dev-name {
            font-size: 1.1em;
            font-weight: bold;
            margin: 0;
            color: var(--color-primary);
        }

        .dev-age {
             font-size: 0.9em;
             margin: 5px 0 10px 0;
             color: #777;
        }

        .dev-role {
            font-size: 0.85em;
            color: #555;
            margin: 5px 0 0 0;
            padding-top: 5px;
            border-top: 1px dashed #eee;
        }
        /* --- FIN ESTILOS "ACERCA DE" --- */
        :root {
            --color-primary: #1a73e8; /* Azul Google */
            --color-secondary: #0f9d58; /* Verde Google */
            --color-bg: #f8f9fa; /* Fondo claro */
            --color-red: #ea4335; /* Rojo Google */
            --color-yellow: #fbbc04; /* Amarillo Google */
            --color-sidebar-bg: #ffffff; /* Fondo del menú */
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-deep: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--color-bg);
            margin: 0;
            overflow-x: hidden;
            color: #333;
        }

        /* Estilo para los Iconos de Google */
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            color: var(--color-primary);
        }

        /* --- Transición de Pantalla Completa --- */
        .full-screen-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 3000;
            background-color: #ffffff;
            opacity: 1;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .hidden-section {
            opacity: 0 !important;
            visibility: hidden;
            transform: translateY(-100%);
        }

        #bienvenida h1 {
            font-size: 4em;
            color: var(--color-primary);
            animation: bounceIn 1s forwards;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .login-card {
            background: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--shadow-deep);
            width: 90%;
            max-width: 350px;
            text-align: center;
        }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 6px; box-sizing: border-box; }
        .login-btn, .btn-submit {
            background-color: var(--color-primary);
            color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; width: 100%;
            font-size: 1.1em; transition: background-color 0.3s;
        }
        .login-btn:hover, .btn-submit:hover { background-color: #1558b0; }

        /* --- NUEVO LAYOUT DE MENÚ LATERAL --- */
        #main-layout {
            display: flex;
            min-height: 100vh;
            width: 100%;
            display: none; /* Se muestra después del login */
        }

        /* Menú Lateral Izquierdo */
        #sidebar {
            width: 250px;
            background-color: var(--color-sidebar-bg);
            box-shadow: var(--shadow-deep);
            padding: 20px 0;
            flex-shrink: 0;
        }

        /* ESTILOS AÑADIDOS/MODIFICADOS PARA EL LOGO */
        #logo-container {
            display: flex;
            align-items: center; /* Centra verticalmente el logo y el texto */
            padding: 0 20px;
            margin-bottom: 25px;
        }

        #logo-img {
            width: 40px; /* Tamaño moderado para el logo */
            height: 40px;
            margin-right: 10px;
            border-radius: 4px; /* Opcional: para logos cuadrados o circulares */
        }

        #sidebar h2 {
            color: var(--color-primary);
            font-size: 1.5em;
            margin: 0; /* Asegura que no haya margen extra del h2 */
        }
        /* FIN ESTILOS LOGO */

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: #333;
            text-decoration: none;
            font-weight: 500;
        }
        .sidebar-item:hover, .sidebar-item.active {
            background-color: var(--color-primary);
            color: white;
        }
        .sidebar-item:hover .material-symbols-outlined, .sidebar-item.active .material-symbols-outlined {
            color: white;
        }
        .sidebar-item .material-symbols-outlined {
            margin-right: 15px;
            font-size: 1.5em;
        }

        /* Estilo para el selector de Inventario Activo */
        #inventory-selector-container {
            padding: 10px 20px;
            border-top: 1px solid #eee;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        #inventory-selector-container label {
            font-size: 0.9em;
            color: #555;
            display: block;
            margin-bottom: 5px;
        }

        /* Área de Contenido Derecha */
        #content-area {
            flex-grow: 1;
            padding: 20px;
            background-color: var(--color-bg);
        }

        /* Encabezado y Botón de Salida */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .btn-delete {
            background-color: var(--color-red);
            color: white;
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        .btn-delete:hover { background-color: #b0150d; }


        /* Contenedor Interior con Límite (El "Recuadro Grande") */
        #content-wrapper {
            max-width: 1000px; /* Límite máximo para el contenido */
            margin: 0 auto; /* Centrar el contenido en el área derecha */
            padding: 30px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: var(--shadow-deep);
        }

        .form-content {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            background-color: #f1f3f4; /* Fondo ligero para formularios */
        }
        .form-content h3 { color: var(--color-primary); }

        /* --- Estilos de la PÁGINA DE INICIO (HOME) --- */
        #home-content {
            display: block; /* Visible por defecto al entrar al layout */
            background-color: #ffffff;
            padding: 0;
        }

        .home-card {
            padding: 30px;
            border-radius: 12px;
            border-left: 5px solid var(--color-secondary);
            margin-bottom: 20px;
            background-color: #f7fcf9;
            box-shadow: var(--shadow-light);
        }
        .home-card h4 { color: var(--color-secondary); }
        .home-card h5 { margin-top: 0; color: #333; }

        /* Estilos específicos para el tutorial */
        .tutorial-card-primary { border-left-color: var(--color-primary) !important; }
        .tutorial-card-secondary { border-left-color: var(--color-secondary) !important; }
        .tutorial-card-yellow { border-left-color: var(--color-yellow) !important; }

        /* --- Estilos para la tabla e inputs (se mantienen) --- */
        .data-table {
            width: 100%; border-collapse: collapse; margin-top: 15px; background: white;
            box-shadow: var(--shadow-light);
        }
        .data-table th, .data-table td {
            padding: 12px 15px; border-bottom: 1px solid #e0e0e0; text-align: left;
        }
        .data-table th { background-color: var(--color-primary); color: white; }
        .data-table tr:hover { background-color: #f0f0f0; cursor: pointer; }
        .form-group { margin-bottom: 15px; display: flex; align-items: center; }
        .form-group label { width: 100px; font-weight: bold; }
        .form-group input, .form-group textarea { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .stock-bajo { font-weight: bold; color: var(--color-red); }

        .btn-table {
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }
        .btn-stock { background-color: var(--color-secondary); }

        /* Modal Generico */
        .modal {
            display: none; position: fixed; z-index: 4000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 480px; border-radius: 10px; box-shadow: var(--shadow-deep);
        }

        /* Pequeños ajustes para inputs dentro del modal */
        .modal-content .form-row { display:flex; gap:10px; margin-bottom:10px; align-items:center; }
        .modal-content label { width: 100px; font-weight:600; }
        .modal-content input, .modal-content select { padding:8px; border-radius:6px; border:1px solid #ccc; flex:1; }

    </style>
</head>
<body>

<section id="bienvenida" class="full-screen-section">
    <h1> BIENVENIDOS A SGI </h1>
</section>

<section id="login-section" class="full-screen-section" style="background-color: var(--color-bg); opacity: 0; visibility: hidden; transition: opacity 0.5s;">
    <div class="login-card">
        <h2>LOGIN</h2>
        <form id="login-form">
            <div class="input-group"><input type="text" id="username" placeholder="Usuario" required></div>
            <div class="input-group"><input type="password" id="password" placeholder="Contraseña" required></div>
            <button type="submit" class="login-btn">Acceder</button>
            <p style="margin-top: 15px; color: #555;">Demo: admin / 123</p>
        </form>
    </div>
</section>

<div id="main-layout">

    <nav id="sidebar">
        <div id="logo-container">
            <img src="img.jpg" alt="Logo SGI" id="logo-img">
            <h2>SGI | Inventario</h2>
        </div>
        <div id="inventory-selector-container">
            <label for="inventory-selector">Inventario Activo:</label>
            <select id="inventory-selector" onchange="changeActiveInventory(this.value)">
            </select>
        </div>

        <a class="sidebar-item active" href="#" onclick="mostrarSeccion('home', this)">
            <span class="material-symbols-outlined">home</span>
            Inicio
        </a>
        <a class="sidebar-item" href="#" onclick="mostrarSeccion('inventario', this)">
            <span class="material-symbols-outlined">inventory</span>
            Ver Inventario
        </a>

        <a class="sidebar-item" href="#" onclick="mostrarSeccion('valoracion', this)">
            <span class="material-symbols-outlined">calculate</span>
            Valoración Total
        </a>

        <a class="sidebar-item" href="#" onclick="mostrarSeccion('nuevo-inventario', this)">
            <span class="material-symbols-outlined">add_to_photos</span>
            Crear Nuevo Inventario
        </a>

        <a class="sidebar-item" href="#" onclick="mostrarSeccion('agregar', this)">
            <span class="material-symbols-outlined">add_box</span>
            Añadir Producto
        </a>

        <a class="sidebar-item" href="#" onclick="abrirModalEliminarInventario()" style="color: var(--color-red);">
            <span class="material-symbols-outlined" style="color: var(--color-red);">delete_forever</span>
            Eliminar un Inventario
        </a>
        <a class="sidebar-item" href="#" onclick="mostrarSeccion('acerca', this)">
            <span class="material-symbols-outlined">info</span>
            Acerca de
        </a>

    </nav>

    <div id="content-area">
        <header>
            <h2 id="current-title" style="margin: 0; color: #555;">Página Principal</h2>
            <button onclick="logout()" class="btn-delete">Cerrar Sesión</button>
        </header>

        <div id="content-wrapper">

            <div id="home-content" class="form-content" style="display:block;">
                <h3 style="color: var(--color-primary);"> Sistema de Gestión Inteligente de Inventario (SGI)</h3>
                <p>El Sistema de Gestión Inteligente de Inventario (SGI) es una plataforma web diseñada para organizaciones,
                    comercios o empresas que manejan un alto volumen de productos o múltiples bodegas, y requieren una herramienta
                    robusta para organizar, controlar y valorizar su inventario de forma efectiva, precisa y en tiempo real.</p>

                <div class="home-card">
                    <h4>Funcionalidades Clave del SGI</h4>
                    <ul>
                        <li>Control CRUD: Crea, edita, busca y elimina productos.</li>
                        <li>Múltiples Inventarios Gestione varios stocks separados (por bodega o tienda).</li>
                        <li>Alerta de Stock: Identifica inmediatamente los productos con existencias bajas (menor a 10 unidades).</li>
                        <li>Valoración Financiera: Calcula el valor total de su inventario en Pesos Colombianos (COP).</li>
                        <li>Interfaz Intuitiva: Diseño moderno, fácil de usar, inspirado en buenas prácticas de usabilidad,
                            para que usuarios con poco conocimiento técnico puedan operar sin dificultades.</li>
                    </ul>
                </div>

                <h3 style="color: var(--color-secondary); margin-top: 30px;">Guía Rápida de Uso (Mini-Tutorial)</h3>

                <div style="display: flex; flex-direction: column; gap: 15px;">

                    <div class="home-card tutorial-card-primary">
                        <h5>1. Ver Inventario</h5>
                        <p>Al seleccionar esta opción, se cargará la tabla completa de productos del inventario activo.
                            Use el buscador para filtrar por ID o nombre. Si hace doble clic en cualquier fila,
                            podrá modificar la cantidad o eliminar el producto.</p>
                    </div>

                    <div class="home-card tutorial-card-secondary">
                        <h5>2. Valoración Total</h5>
                        <p>Su función es calcular automáticamente el valor total de todos los productos
                            disponibles en el inventario activo. Además, muestra el número total de productos únicos,
                            ofreciendo una visión rápida y precisa del patrimonio almacenado.</p>
                    </div>

                    <div class="home-card tutorial-card-yellow">
                        <h5>3. Crear Nuevo Inventario</h5>
                        <p>Permite crear una nueva base de inventario desde cero. El usuario puede asignar un nombre personalizado
                            y definir las categorías principales que servirán para organizar y clasificar todos los productos de manera eficiente.</p>
                    </div>
                </div>

            </div>

            <div id="inventario-content" class="form-content">
                <h3>Inventario Actual (<span id="active-inventory-name">Inventario Principal</span>)</h3>
                <div style="margin-bottom: 15px;">
                    <input type="text" id="search-input" placeholder="Buscar por ID, Nombre, Detalle o Categoría..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                </div>

                <table class="data-table" id="tabla-inventario">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Detalle</th>
                        <th>Cantidad</th>
                        <th>Precio (COP)</th>
                        <th>Categoría</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="valoracion-content" class="form-content">
                <h3 style="color: var(--color-secondary);"> Resumen de Valoración del Inventario</h3>
                <p>Esta sección muestra la cantidad total de artículos únicos en stock y el valor monetario total del inventario.</p>

                <div id="valoracion-results" style="padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f7f7f7; margin-top: 20px;">
                    <div style="margin-bottom: 15px;">
                        <h4>Productos Únicos Disponibles (<span id="active-inventory-name-val">Inventario Principal</span>):</h4>
                        <p id="total-productos" style="font-size: 2em; color: var(--color-primary); font-weight: bold;">Cargando...</p>
                    </div>

                    <div>
                        <h4>Valor Total del Inventario (COP):</h4>
                        <p id="valor-total" style="font-size: 2.5em; color: var(--color-secondary); font-weight: 700;">Cargando...</p>
                    </div>
                </div>
            </div>

            <div id="nuevo-inventario-content" class="form-content">
                <h3>Crear Nuevo Inventario</h3>
                <form id="form-nuevo-inventario">
                    <p>Defina la configuración de su nuevo inventario.</p>
                    <div class="form-group"><label>Nombre:</label><input id="new-inventory-name" placeholder="Ej: Inventario Bodega Principal" required></div>
                    <div class="form-group"><label>Categorías:</label><textarea id="new-inventory-categories" placeholder="Separe las categorías por coma (Ej: Tecnología, Ropa, Hogar)" required></textarea></div>
                    <button class="btn-submit" type="submit" style="margin-top: 20px;">Crear y Activar Inventario</button>
                </form>
            </div>


            <div id="agregar-content" class="form-content">
                <h3>Agregar Producto al Inventario (<span id="add-inventory-name">Inventario Principal</span>)</h3>
                <form id="form-agregar">
                    <p style="font-size: 0.9em; color: var(--color-primary);">El ID del producto se generará automáticamente según la categoría.</p>
                    <div class="form-group"><label>Nombre:</label><input id="add-nombre" placeholder="Nombre completo del producto" required></div>
                    <div class="form-group"><label>Detalle:</label><input id="add-detalle" placeholder="Ej: Talla M / Rojo, 512GB / Gris" required></div>
                    <div class="form-group"><label>Categoría:</label><input id="add-categoria" placeholder="Ej: Tecnología, Ropa, Hogar" required></div>
                    <div class="form-group"><label>Cantidad:</label><input type="number" id="add-cantidad" min="1" value="1" required></div>
                    <div class="form-group"><label>Precio:</label><input type="number" id="add-precio" min="0" placeholder="Precio en COP (Ej: 1500000)" required></div>
                    <button class="btn-submit" type="submit" style="margin-top: 20px;">Guardar Producto</button>
                </form>
            </div>

            <div id="acerca-content" class="form-content">
                <h3 class="acerca-title" style="color: var(--color-primary);">Acerca de SGI</h3>

                <div id="acerca-logo-container">
                    <img src="img.jpg" alt="Logo SGI" id="acerca-logo-img">
                    <p class="acerca-slogan">"Organizamos inventarios, construimos eficiencia"</p>
                </div>

                <div id="acerca-devs-container">
                    <h4 class="acerca-subtitle">Desarrolladores del Proyecto:</h4>

                    <div class="dev-card">
                        <img src="brayan.jpg" alt="Foto de Brayan" class="dev-photo">
                        <p class="dev-name">Brayan Stiven Piraneque Balaguera</p>
                        <p class="dev-edad">Edad: 21</p>
                        <p class="dev-contacto">Contacto: 310-208-3705</p>
                        <p class="dev-role">Scrum Master/Developer Teams</p>
                    </div>

                    <div class="dev-card">
                        <img src="cristian.jpg" alt="Foto de Cristian" class="dev-photo">
                        <p class="dev-name">Cristian Steven Quiroga Alfonso</p>
                        <p class="dev-edad">Edad: 22</p>
                        <p class="dev-contacto">Contacto: 322-805-9671</p>
                        <p class="dev-role">Product Owner/Developer Teams</p>
                    </div>

                    <div class="dev-card">
                        <img src="alejandro.jpg" alt="Foto de Alejandro" class="dev-photo">
                        <p class="dev-name">Diego Alejandro Fonseca Jaimes</p>
                        <p class="dev-edad">Edad: 18</p>
                        <p class="dev-contacto">Contacto: 312-472-8773</p>
                        <p class="dev-role">Developer Teams</p>
                    </div>
                </div>

                <p class="acerca-version"><strong>Versión:</strong> 2.2.3</p>
            </div>

        </div> </div> </div>

<div id="edit-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="document.getElementById('edit-modal').style.display='none';" style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
        <h3 id="modal-product-name" style="color:var(--color-primary);">Detalles del Producto</h3>
        <p>ID: <strong id="modal-product-id"></strong></p>

        <div style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
            <div class="form-row">
                <label>Nombre:</label>
                <input id="modal-name-input" type="text" />
            </div>

            <div class="form-row">
                <label>Detalle:</label>
                <input id="modal-detail-input" type="text" />
            </div>

            <div class="form-row">
                <label>Categoría:</label>
                <input id="modal-category-input" type="text" />
            </div>

            <div class="form-row">
                <label>Precio:</label>
                <input id="modal-price-input" type="number" min="0" />
            </div>

            <div class="form-row">
                <label>Cantidad:</label>
                <input id="modal-quantity-input" type="number" min="0" />
            </div>

            <button id="btn-save-product" class="btn-submit" style="margin-top: 15px; background-color: var(--color-secondary);">Guardar Cambios</button>
        </div>

        <button id="btn-delete-product" class="btn-delete" style="margin-top: 15px; width:100%;">Eliminar Producto</button>
    </div>
</div>

<div id="delete-inventory-modal" class="modal">
    <div class="modal-content" style="border: 2px solid var(--color-red);">
        <span class="close-btn" onclick="document.getElementById('delete-inventory-modal').style.display='none';" style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
        <h3 style="color: var(--color-red);">Eliminar un Inventario</h3>
        <p>Seleccione el inventario que desea eliminar permanentemente. <br><strong>¡Esta acción no se puede deshacer!</strong></p>

        <div class="form-group" style="flex-direction: column; align-items: flex-start;">
            <label style="width: 100%; margin-bottom: 5px;">Seleccionar Inventario:</label>
            <select id="delete-inventory-select" style="width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px;">
            </select>
        </div>

        <button onclick="confirmDeleteInventory()" class="btn-delete" style="width: 100%; margin-top: 20px;">Confirmar Eliminación</button>
        <button onclick="document.getElementById('delete-inventory-modal').style.display='none';" class="btn-submit" style="width: 100%; margin-top: 10px; background-color: #777;">Cancelar</button>
    </div>
</div>


<script>
    const VALID_USER = 'admin';
    const VALID_PASS = '123';
    const STOCK_WARNING_LEVEL = 10;
    const INVENTORY_STORAGE_KEY = 'sgi_multiple_inventarios';
    const ACTIVE_INVENTORY_KEY = 'sgi_inventario_activo';
    const PRODUCT_COUNT_TARGET = 100;

    // Prefijos para la generación automática de ID
    const categoryPrefixes = {
        'Tecnología': 'TEC',
        'Ropa': 'ROP',
        'Hogar': 'HOG',
    };

    let globalInventories = {};
    let activeInventoryId = 'Inventario Principal';

    function generateInitialData(count) {
        const categories = ['Tecnología', 'Ropa', 'Hogar'];
        const prefixes = { 'Tecnología': 'TEC', 'Ropa': 'ROP', 'Hogar': 'HOG' };
        const sizes = ['S', 'M', 'L', 'XL'];
        const colors = ['Rojo', 'Azul', 'Blanco', 'Negro', 'Gris', 'Verde'];

        const techModels = [
            { name: 'Laptop HP Pavilion', details: ['i5 / 8GB RAM / 512GB SSD', 'i7 / 16GB RAM / 1TB SSD'], priceBase: 2500000 },
            { name: 'Monitor Samsung Curvo', details: ['27 Pulgadas / 144hz', '32 Pulgadas / 60hz'], priceBase: 1200000 },
            { name: 'Consola PS5', details: ['Digital Edition', 'Disco Edition'], priceBase: 3500000 },
            { name: 'Smartphone Xiaomi 13T', details: ['128GB', '256GB'], priceBase: 1800000 }
        ];

        const apparelModels = [
            { name: 'Jean Diesel Slim', priceBase: 150000 },
            { name: 'Camiseta Polo Lacoste', priceBase: 90000 },
            { name: 'Chaqueta Impermeable NorthFace', priceBase: 250000 }
        ];

        const homeModels = [
            { name: 'Licuadora Oster Xpert', priceBase: 180000 },
            { name: 'Juego de Sábanas 400 Hilos', priceBase: 80000 },
            { name: 'Aspiradora Robot Samsung', priceBase: 900000 }
        ];

        let initialData = [];
        const randomPrice = (base) => Math.floor(base * (1 + (Math.random() * 0.5 - 0.25)) / 100) * 100;

        for (let i = 1; i <= count; i++) {
            const categoryIndex = i % categories.length;
            const category = categories[categoryIndex];
            const prefix = prefixes[category];
            const id = `${prefix}-${String(i).padStart(3, '0')}`;
            let nombre, detalle, precio;

            if (category === 'Ropa') {
                const model = apparelModels[Math.floor(Math.random() * apparelModels.length)];
                const size = sizes[Math.floor(Math.random() * sizes.length)];
                const color = colors[Math.floor(Math.random() * colors.length)];
                nombre = model.name;
                detalle = `Talla ${size} / Color ${color}`;
                precio = randomPrice(model.priceBase);
            } else if (category === 'Tecnología') {
                const model = techModels[Math.floor(Math.random() * techModels.length)];
                const detail = model.details[Math.floor(Math.random() * model.details.length)];
                nombre = model.name;
                detalle = detail;
                precio = randomPrice(model.priceBase);
            } else { // Hogar
                const model = homeModels[Math.floor(Math.random() * homeModels.length)];
                nombre = model.name;
                detalle = colors[Math.floor(Math.random() * colors.length)];
                precio = randomPrice(model.priceBase);
            }

            initialData.push({
                id: id,
                nombre: nombre,
                cantidad: Math.floor(Math.random() * 50) + 1,
                precio: precio,
                categoria: category,
                detalle: detalle
            });
        }
        return initialData;
    }

    function loadInventories() {
        const storedInventories = localStorage.getItem(INVENTORY_STORAGE_KEY);
        const storedActiveId = localStorage.getItem(ACTIVE_INVENTORY_KEY);

        if (storedInventories) {
            globalInventories = JSON.parse(storedInventories);
        } else {
            const initialProducts = generateInitialData(PRODUCT_COUNT_TARGET);
            globalInventories['Inventario Principal'] = {
                name: 'Inventario Principal',
                categories: ['Tecnología', 'Ropa', 'Hogar'],
                products: initialProducts
            };
        }

        if (storedActiveId && globalInventories[storedActiveId]) {
            activeInventoryId = storedActiveId;
        } else {
            const keys = Object.keys(globalInventories);
            if (keys.length > 0) activeInventoryId = keys[0];
        }
        saveInventories();
    }

    function saveInventories() {
        localStorage.setItem(INVENTORY_STORAGE_KEY, JSON.stringify(globalInventories));
        localStorage.setItem(ACTIVE_INVENTORY_KEY, activeInventoryId);
        updateInventorySelector();
        updateInventoryTitles();
    }

    function getCurrentInventory() {
        return globalInventories[activeInventoryId] ? globalInventories[activeInventoryId].products : [];
    }

    function updateInventoryTitles() {
        if(globalInventories[activeInventoryId]){
            const name = globalInventories[activeInventoryId].name;
            document.getElementById('active-inventory-name').textContent = name;
            document.getElementById('active-inventory-name-val').textContent = name;
            document.getElementById('add-inventory-name').textContent = name;
        }
    }

    function updateInventorySelector() {
        const selector = document.getElementById('inventory-selector');
        selector.innerHTML = '';
        const deleteSelector = document.getElementById('delete-inventory-select');
        deleteSelector.innerHTML = '';

        const keys = Object.keys(globalInventories);

        keys.forEach(key => {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = globalInventories[key].name;
            if (key === activeInventoryId) {
                option.selected = true;
            }
            selector.appendChild(option);

            // Añadir al selector de eliminación, excluyendo el activo si es el único
            if (keys.length > 1 || key !== activeInventoryId) {
                 const deleteOption = document.createElement('option');
                 deleteOption.value = key;
                 deleteOption.textContent = globalInventories[key].name;
                 deleteSelector.appendChild(deleteOption);
            }
        });

        // Deshabilitar la opción de eliminar si solo queda un inventario
        if (keys.length <= 1) {
            const onlyOption = document.createElement('option');
            onlyOption.value = '';
            onlyOption.textContent = 'No se puede eliminar el último inventario';
            onlyOption.disabled = true;
            deleteSelector.appendChild(onlyOption);
            deleteSelector.value = '';
        }
    }

    function changeActiveInventory(newId) {
        if (globalInventories[newId]) {
            activeInventoryId = newId;
            saveInventories();
            renderizarTabla();
            calcularValoracion();
            mostrarSeccion(document.querySelector('.form-content[style*="display:block"]').id.replace('-content', ''), document.querySelector('.sidebar-item.active'));
            alert(`Inventario cambiado a: ${globalInventories[newId].name}`);
        }
    }

    // --- NUEVA FUNCIÓN PARA GENERAR ID AUTOMÁTICO ---
    function generateNewProductId(category) {
        const inventory = getCurrentInventory();
        const normalizedCategory = category.trim();

        // 1. Determinar el prefijo (usa las 3 primeras letras de la categoría si no hay prefijo predefinido)
        let prefix = categoryPrefixes[normalizedCategory] || normalizedCategory.substring(0, 3).toUpperCase();

        // Limpiar el prefijo (solo letras y números)
        prefix = prefix.replace(/[^A-Z0-9]/g, '').toUpperCase();
        if (prefix.length === 0) prefix = 'PRO'; // Fallback

        let maxNumber = 0;

        // Regex para encontrar IDs que coincidan con el patrón (ej: TEC-001)
        const idRegex = new RegExp(`^${prefix}-(\\d+)$`);

        // 2. Encontrar el número secuencial más alto
        inventory.forEach(p => {
            const match = p.id.match(idRegex);
            if (match) {
                const currentNumber = parseInt(match[1]);
                if (currentNumber > maxNumber) {
                    maxNumber = currentNumber;
                }
            }
        });

        // 3. Generar el nuevo ID
        const newNumber = maxNumber + 1;
        // Rellenar con ceros a la izquierda (ej: 1 -> 001)
        const paddedNumber = String(newNumber).padStart(3, '0');

        return `${prefix}-${paddedNumber}`;
    }
    // --- FIN NUEVA FUNCIÓN ---


    const bienvenidaSection = document.getElementById('bienvenida');
    const loginSection = document.getElementById('login-section');
    const mainLayout = document.getElementById('main-layout');
    const tablaBody = document.querySelector('#tabla-inventario tbody');
    const loginForm = document.getElementById('login-form');
    const formAgregar = document.getElementById('form-agregar');
    const formNuevoInventario = document.getElementById('form-nuevo-inventario');
    const searchInput = document.getElementById('search-input');
    const currentTitle = document.getElementById('current-title');

    const totalProductosDisplay = document.getElementById('total-productos');
    const valorTotalDisplay = document.getElementById('valor-total');

    const editModal = document.getElementById('edit-modal');
    const modalProductName = document.getElementById('modal-product-name');
    const modalProductId = document.getElementById('modal-product-id');
    const modalNameInput = document.getElementById('modal-name-input');
    const modalDetailInput = document.getElementById('modal-detail-input');
    const modalCategoryInput = document.getElementById('modal-category-input');
    const modalPriceInput = document.getElementById('modal-price-input');
    const modalQuantityInput = document.getElementById('modal-quantity-input');
    const btnSaveProduct = document.getElementById('btn-save-product');
    const btnDeleteProduct = document.getElementById('btn-delete-product');

    // Modal de Eliminacion de Inventario
    const deleteInventoryModal = document.getElementById('delete-inventory-modal');
    const deleteInventorySelect = document.getElementById('delete-inventory-select');


    let currentEditProductId = null;

    const formContents = {
        'home': document.getElementById('home-content'),
        'inventario': document.getElementById('inventario-content'),
        'valoracion': document.getElementById('valoracion-content'),
        'nuevo-inventario': document.getElementById('nuevo-inventario-content'),
        'agregar': document.getElementById('agregar-content'),
        'acerca': document.getElementById('acerca-content')
    };

    const titles = {
        'home': 'Página Principal',
        'inventario': 'Gestión de Inventario',
        'valoracion': 'Reporte de Valoración',
        'nuevo-inventario': 'Crear Nuevo Inventario',
        'agregar': 'Añadir Nuevo Producto',
        'acerca': 'Información del Sistema'
    };

    // --- FUNCIONES DE NAVEGACIÓN Y LOGIN ---

    function iniciarApp() {
        // Simular un retardo en la bienvenida
        setTimeout(() => {
            bienvenidaSection.style.opacity = 0;
            bienvenidaSection.style.visibility = 'hidden';

            loginSection.style.opacity = 1;
            loginSection.style.visibility = 'visible';

        }, 1500);

        loadInventories();
    }

    function login(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (username === VALID_USER && password === VALID_PASS) {
            // Ocultar login y mostrar layout principal
            loginSection.style.display = 'none';
            mainLayout.style.display = 'flex';

            // Inicializar vistas con los datos cargados
            renderizarTabla();
            calcularValoracion();
            mostrarSeccion('home', document.querySelector('.sidebar-item.active'));

        } else {
            alert('Credenciales incorrectas. Intente de nuevo.');
        }
    }

    function logout() {
        if (confirm('¿Está seguro que desea cerrar la sesión?')) {
            // Resetear la vista
            mainLayout.style.display = 'none';
            loginSection.style.display = 'flex';
            document.getElementById('password').value = ''; // Limpiar campo de contraseña
            document.getElementById('username').value = '';
            loadInventories();
        }
    }

    function mostrarSeccion(sectionId, element) {
        // Ocultar todas las secciones de contenido
        Object.values(formContents).forEach(content => {
            content.style.display = 'none';
        });

        // Mostrar la sección solicitada
        const targetContent = formContents[sectionId];
        if (targetContent) {
            targetContent.style.display = 'block';
            currentTitle.textContent = titles[sectionId];
        }

        // Remover 'active' de todos los elementos del sidebar
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.classList.remove('active');
        });

        // Añadir 'active' al elemento clickeado
        if (element) {
            element.classList.add('active');
        }

        // Acciones específicas al cambiar de sección
        if (sectionId === 'inventario') {
            renderizarTabla();
        } else if (sectionId === 'valoracion') {
            calcularValoracion();
        }
    }

    // --- FUNCIONES DE GESTIÓN DE INVENTARIO ---

    function formatCurrency(number) {
        if (typeof number !== 'number') return 'N/A';
        return new Intl.NumberFormat('es-CO', {
            style: 'currency',
            currency: 'COP',
            minimumFractionDigits: 0
        }).format(number);
    }

    function renderizarTabla(filterText = '') {
        const inventory = getCurrentInventory();
        tablaBody.innerHTML = '';
        const filterLower = filterText.toLowerCase();

        const filteredInventory = inventory.filter(p =>
            p.id.toLowerCase().includes(filterLower) ||
            p.nombre.toLowerCase().includes(filterLower) ||
            p.detalle.toLowerCase().includes(filterLower) ||
            p.categoria.toLowerCase().includes(filterLower)
        );

        filteredInventory.forEach(producto => {
            const row = tablaBody.insertRow();

            // Atributo para identificar el producto al hacer doble clic
            row.ondblclick = () => abrirModalEdicion(producto.id);

            // Aplicar estilo de advertencia de stock
            if (producto.cantidad <= STOCK_WARNING_LEVEL) {
                row.classList.add('stock-bajo');
            }

            row.insertCell().textContent = producto.id;
            row.insertCell().textContent = producto.nombre;
            row.insertCell().textContent = producto.detalle;

            const cellCantidad = row.insertCell();
            cellCantidad.textContent = producto.cantidad;
            if (producto.cantidad <= STOCK_WARNING_LEVEL) {
                 // Puedes añadir un icono para más visibilidad
                 cellCantidad.innerHTML = `<span class="material-symbols-outlined" style="font-size: 1.2em; vertical-align: middle; color: ${getComputedStyle(document.documentElement).getPropertyValue('--color-red')}">warning</span> ${producto.cantidad}`;
            }

            row.insertCell().textContent = formatCurrency(producto.precio);
            row.insertCell().textContent = producto.categoria;
        });
    }

    function calcularValoracion() {
        const inventory = getCurrentInventory();
        let totalProductos = 0;
        let valorTotal = 0;

        inventory.forEach(p => {
            totalProductos += p.cantidad;
            valorTotal += p.cantidad * p.precio;
        });

        totalProductosDisplay.textContent = totalProductos;
        valorTotalDisplay.textContent = formatCurrency(valorTotal);
    }

    function abrirModalEdicion(productId) {
        const inventory = getCurrentInventory();
        const product = inventory.find(p => p.id === productId);

        if (!product) {
            alert('Producto no encontrado.');
            return;
        }

        currentEditProductId = productId; // Guardar el ID para la edición

        modalProductName.textContent = product.nombre;
        modalProductId.textContent = product.id;
        modalNameInput.value = product.nombre;
        modalDetailInput.value = product.detalle;
        modalCategoryInput.value = product.categoria;
        modalPriceInput.value = product.precio;
        modalQuantityInput.value = product.cantidad;

        editModal.style.display = 'block';
    }

    function guardarProductoEditado() {
        const inventory = getCurrentInventory();
        const productIndex = inventory.findIndex(p => p.id === currentEditProductId);

        if (productIndex === -1) {
            alert('Error: Producto no encontrado para guardar.');
            return;
        }

        // Obtener y validar nuevos valores
        const newName = modalNameInput.value.trim();
        const newDetail = modalDetailInput.value.trim();
        const newCategory = modalCategoryInput.value.trim();
        const newPrice = parseFloat(modalPriceInput.value);
        const newQuantity = parseInt(modalQuantityInput.value);

        if (newName === "" || newDetail === "" || newCategory === "" || isNaN(newPrice) || newPrice < 0 || isNaN(newQuantity) || newQuantity < 0) {
             alert("Por favor, complete todos los campos y asegúrese de que el precio y la cantidad son números válidos y no negativos.");
             return;
        }

        // Aplicar los cambios
        inventory[productIndex].nombre = newName;
        inventory[productIndex].detalle = newDetail;
        inventory[productIndex].categoria = newCategory;
        inventory[productIndex].precio = newPrice;
        inventory[productIndex].cantidad = newQuantity;

        // Persistir los datos
        saveInventories();

        alert(`Producto ${currentEditProductId} actualizado con éxito.`);
        editModal.style.display = 'none';
        renderizarTabla();
        calcularValoracion();
    }

    function eliminarProducto() {
        if (!confirm(`¿Está seguro de eliminar el producto con ID: ${currentEditProductId}? Esta acción no se puede deshacer.`)) {
            return;
        }

        let inventory = getCurrentInventory();
        const initialLength = inventory.length;

        // Filtrar para crear un nuevo array sin el producto
        const newInventory = inventory.filter(p => p.id !== currentEditProductId);

        if (newInventory.length === initialLength) {
            alert('Error al eliminar el producto. ID no encontrado.');
            return;
        }

        // Actualizar el inventario activo
        globalInventories[activeInventoryId].products = newInventory;

        // Persistir los datos
        saveInventories();

        alert(`Producto ${currentEditProductId} eliminado con éxito.`);
        editModal.style.display = 'none';
        renderizarTabla();
        calcularValoracion();
    }

    // --- MANEJO DE FORMULARIOS ---

    function addNewProduct(e) {
        e.preventDefault();

        // Removimos la lectura del ID y usamos la nueva función de generación
        const nombre = document.getElementById('add-nombre').value.trim();
        const detalle = document.getElementById('add-detalle').value.trim();
        const categoria = document.getElementById('add-categoria').value.trim();
        const cantidad = parseInt(document.getElementById('add-cantidad').value);
        const precio = parseFloat(document.getElementById('add-precio').value);

        // Validación de campos antes de generar ID
        if (nombre === "" || detalle === "" || categoria === "") {
             alert("Por favor, complete todos los campos de texto.");
             return;
        }
        if (cantidad <= 0 || precio < 0 || isNaN(cantidad) || isNaN(precio)) {
            alert("La cantidad debe ser un número positivo y el precio debe ser cero o positivo.");
            return;
        }

        // Generar el ID
        const id = generateNewProductId(categoria);

        const inventory = getCurrentInventory();

        const nuevoProducto = { id, nombre, detalle, categoria, cantidad, precio };
        inventory.push(nuevoProducto);

        // Persistir y actualizar
        saveInventories();

        // Limpiar formulario y notificar
        formAgregar.reset();
        alert(`Producto "${nombre}" (ID generado: ${id}) agregado al inventario activo.`);
    }

    function createNewInventory(e) {
        e.preventDefault();

        const name = document.getElementById('new-inventory-name').value.trim();
        const categoriesText = document.getElementById('new-inventory-categories').value.trim();
        const categories = categoriesText.split(',').map(c => c.trim()).filter(c => c.length > 0);

        if (globalInventories[name]) {
            alert(`Error: Ya existe un inventario con el nombre "${name}". Por favor, elija otro nombre.`);
            return;
        }
        if (categories.length === 0) {
             alert('Debe definir al menos una categoría para el nuevo inventario.');
             return;
        }

        // Crear el nuevo inventario
        globalInventories[name] = {
            name: name,
            categories: categories,
            products: [] // Empieza vacío
        };

        // Activarlo inmediatamente
        activeInventoryId = name;

        // Persistir y actualizar la interfaz
        saveInventories();

        // Limpiar formulario y notificar
        formNuevoInventario.reset();
        alert(`Inventario "${name}" creado y activado con éxito. Categorías: ${categories.join(', ')}`);

        // Regresar a la vista de agregar producto o inventario
        mostrarSeccion('agregar', document.querySelector('.sidebar-item[onclick*="agregar"]'));
    }

    function abrirModalEliminarInventario() {
        updateInventorySelector(); // Asegura que el selector esté actualizado
        if (Object.keys(globalInventories).length <= 1) {
            alert('No puede eliminar el último inventario. Cree uno nuevo para poder eliminar este.');
            return;
        }
        deleteInventoryModal.style.display = 'block';
    }

    function confirmDeleteInventory() {
        const idToDelete = deleteInventorySelect.value;

        if (!idToDelete) {
             alert('Por favor, seleccione un inventario para eliminar.');
             return;
        }

        if (idToDelete === activeInventoryId) {
            alert('Error: No puede eliminar el inventario que está actualmente activo. Por favor, cambie a otro inventario y vuelva a intentarlo.');
            return;
        }

        if (confirm(`ATENCIÓN: ¿Está seguro de eliminar el inventario "${globalInventories[idToDelete].name}"? Todos los datos se perderán permanentemente.`)) {

            // Eliminar del objeto global
            delete globalInventories[idToDelete];

            // Persistir los datos (el inventario activo se mantiene igual o se reasigna si era el eliminado)
            saveInventories();

            alert(`Inventario "${idToDelete}" eliminado con éxito.`);
            deleteInventoryModal.style.display = 'none';
        }
    }


    // --- LISTENERS (ASOCIACIÓN DE EVENTOS) ---

    // Login
    loginForm.addEventListener('submit', login);

    // Agregar Producto
    formAgregar.addEventListener('submit', addNewProduct);

    // Crear Nuevo Inventario
    formNuevoInventario.addEventListener('submit', createNewInventory);

    // Buscar Producto
    searchInput.addEventListener('input', (e) => {
        renderizarTabla(e.target.value);
    });

    // Guardar Edición de Producto
    btnSaveProduct.addEventListener('click', guardarProductoEditado);

    // Eliminar Producto
    btnDeleteProduct.addEventListener('click', eliminarProducto);

    // Iniciar la aplicación al cargar
    document.addEventListener('DOMContentLoaded', iniciarApp);

</script>
</body>
</html>